---
title: Lake Formation TBAC strategy
description: References - Lake Formation TBAC strategy
---
import DualCode from '../../../components/DualCode.astro';



We recomend that a Tag Based Access Control (TBAC) strategy be used in Lake Formation. This is the default
as defined by the `hybridMode` flag that is set false to disallow IAM management

In short, instead of assigning permissions to individual resources, you tag the resources and grant permissions upon those tags.
This approach simplifies data governance. By implementing a strong tagging strategy, you can significantly reduce the effort
required to set up and manage permissions.

To summarize, here are the main concepts:
- **LF-tags** are key-value pairs attached to resources
- **Resources** are databases, tables and columns registered in Lake Formation
- **Principals** are IAM entities, but also AWS accounts, Organizations and organizational units
- Principals are given access to resources via **grants** on respective LF-tags

## Tag Based Access Control (TBAC)

We express grants as SQL statements but are pseudocode to easily conceptualize the
permissions that are being granted. They translate into CloudFormation/CDK constructs.
In pseducode, a grant looks like this:
```sql
GRANT ACCESS ON TAGS foo=bar AND spam=eggs TO DataLakeUser
```

### Rules

LF tags follow a small but fundamental set of rules:

- Tags are assigned to data catalog resources (databases, tables, columns), and a resource can have multiple tags attached, to a maximum of **50 tags**, and **no duplicate keys**.
- Grants are made **TO** principals **ON** tags.

  ```sql
  GRANT ACCESS ON TAGS foo=bar TO user
    ```
- In grant expressions, all tag **keys** are evaluated in an `AND` fashion, whereas tag **values** are evaluated in an `OR` fashion.

  ```sql
  GRANT ACCESS ON TAGS foo=bar AND spam=eggs TO user
  -- `user` has access on resources tagged both `foo=bar` AND `spam=eggs`

  GRANT ACCESS ON TAGS foo=['bar', 'baz'] TO user
  -- `user` has access on resources tagged with either `foo=bar` OR `foo=baz`
  ```
- Tags assigned to resources are **inherited**, unless specifically overridden.

  ![Tag Inheritance Diagram](imgs/tag_inheritance.png)
- Grants allow access to resources where **ALL** conditions are true.

  ![Grants Diagram](imgs/grants_diagram.png)


### Limitations

There are some limitations that may restrict the flexibility of creating tag systems.

- A resource cannot have the same LF-tag key more than once.

  For instance, you can't both add `team = sales` and `team = marketing` to the same table.

  One workaround is to embed the name inside the tag key, and turn the tag into a toggle:
  `team:sales = true` and `team:marketing = true`.

- A `GRANT` cannot use `OR` for different tag keys, the Grant below is INVALID:

  ❌ Invalid
  ```sql
  GRANT ACCESS ON TAGS foo=bar OR spam=eggs TO user
  ```

  ✅ Valid
  ```sql
  GRANT ACCESS ON TAGS foo=bar TO user
  GRANT ACCESS ON TAGS spam=eggs TO user
  ```


### Suggestions

Given the rules and limitations mentioned, use the following tips when designing your tagging system.

- Since LF-tags are hierarchical, a `GRANT` on a tag key-value pair applied to a high level resource (e.g. a database) inherently allows access to all of its children with the same value, no matter all the other tags that may exist on those resources.

- When writing a single `GRANT` statement, rember tags are `ANDed` and can not be `ORed`. For example:

  ```sql
  GRANT ACCESS ON TAGS team:marketing=true TO executives
  ```
  Allows the group `executives` to access everything that has the tag `team:marketing=true`

  If the statement is changed to be:
  ```sql
  GRANT ACCESS ON TAGS team:marketing=true AND PII=true TO executives
  ```

  This grants executives access to resources that are tagged with BOTH `team:marketing=true` and `PII=true`.


### Other Sources
- https://aws.github.io/aws-lakeformation-best-practices/
- https://docs.aws.amazon.com/lake-formation/latest/dg/lf-tag-considerations.html


## Tag Strategy

There is no one-size-fits all solution, the most ideal strategy is the one that best reflects an organization’s
structure. The recommended strategy is a modified version of the
suggested [AWS recommended Common LF-Tag Ontologies](https://aws.github.io/aws-lakeformation-best-practices/lf-tags/common-ontologies/).

- `product:<product_name> = true`: Apply to resources that belong to a specific product.
- `team:<team_name> = true`: Apply to resources belonging to a specific team.
- `sensitive = [true, false]`: For those resources that contain sensitive data such as PII.
- `sharable = [true, false]`: For resources that can be shared with other teams.

## Roles and Grants

We recommend having roles defined (roughly) in a structure such as this one:
- `AdminTeamRole` - For users with executive/admin responsibilities.
- `<team_name>TeamRole` - For users belonging to a specific team, e.g. `SalesTeamRole`.

The following grants can be created for defaults, the baseline from which to branch off if more specific needs arise.

- Admins have access to every resource.
  ```sql
  GRANT READ ACCESS ON TAGS team:Admins=true
  ```

- Everyone has access to resources tagged as sharable.
  ```sql
  GRANT READ ACCESS ON TAGS sharable=true
  ```

- Teams have access to resources tagged with their team's name, but only those not flagged as sensitive.
  ```sql
  GRANT FULL ACCESS ON TAGS team:<team_name>=true AND sensitive=false
  ```
