---
title: Tag Based Access Control Guide
description: Lake Formation - Tag Based Access Control Guide
---
import tagInheritance from './imgs/tag_inheritance.png'
import grantsDiagram from './imgs/grants_diagram.png'

:::note
The source materials for this guide can be found at the following links:
- https://aws.github.io/aws-lakeformation-best-practices/
- https://docs.aws.amazon.com/lake-formation/latest/dg/lf-tag-considerations.html
:::

Lake Formation access control is based on a tagging system.

In short, instead of assigning permissions to individual resources, you tag the resources and grant permissions upon those tags.

This approach simplifies data governance. By implementing a strong tagging strategy (a recommended one is provided in the next section), you can significantly reduce the effort required to set up and manage permissions.

:::note
All examples that follow are in pseudocode to make them simple to understand.
:::

## Rules

LF tags follow a small but fundamental set of rules:

- ðŸ“œ Tags are assigned to data catalog resources (databases, tables, columns), and a resource can have multiple tags attached, to a maximum of **50 tags**, and **no duplicate keys**.
- ðŸ“œ Grants are made **TO** principals **ON** tags.

    ```sql
    GRANT ACCESS ON TAGS foo=bar TO user
    ```
- ðŸ“œ In grant expressions, all tag **keys** are evaluated in an `AND` fashion, whereas tag **values** are evaluated in an `OR` fashion.

    ```sql
    GRANT ACCESS ON TAGS foo=bar AND spam=eggs TO user
    -- `user` has access on resources tagged both `foo=bar` AND `spam=eggs`

    GRANT ACCESS ON TAGS foo=['bar', 'baz'] TO user
    -- `user` has access on resources tagged with either `foo=bar` OR `foo=baz`
    ```
- ðŸ“œ Tags assigned to resources are **inherited**, unless specifically overridden.
    <p align='center'>
        <img src={tagInheritance.src} alt="Tag Inheritance Diagram" width='75%'/>
    </p>
- ðŸ“œ Grants allow access to resources where **ALL** conditions are true.
    <p align='center'>
        <img src={grantsDiagram.src} alt="Grants Diagram" width='75%'/>
    </p>

You should always keep in mind the above rules when designing a tagging strategy for your Lake Formation.

## Limitations

There are some limitations that may restrict the flexibility of creating tag systems.

:::caution
A resource cannot have the same LF-tag key more than once.

For instance, you can't both add `team = sales` and `team = marketing` to the same table.

One workaround is to embed the name inside the tag key, and turn the tag into a toggle:
`team:sales = true` and `team:marketing = true`.
:::

:::caution
A `GRANT` cannot use `OR` for different tag keys:

```sql
GRANT ACCESS ON TAGS foo=bar OR spam=eggs TO user  -- IMPOSSIBLE!
```

The workaround is to have multiple grant statements:
```sql
GRANT ACCESS ON TAGS foo=bar TO user
GRANT ACCESS ON TAGS spam=eggs TO user
```
:::

## Suggestions

Given the rules and limitations mentioned, use the following tips when designing your tagging system.

- Since LF-tags are hierarchical, a `GRANT` on a tag key-value pair applied to a high level resource (e.g. a database) inherently allows access to all of its children with the same value, no matter all the other tags that may exist on those resources.

- When writing a single `GRANT` statement, one should think **"ONLY"** rather than **"ALSO"**:

    ```sql
    GRANT ACCESS ON TAGS team:marketing=true TO executives
    ```
    Allows the group `executives` to access everything that has the tag `team:marketing=true`

    If the statement is changed to be:
    ```sql
    GRANT ACCESS ON TAGS team:marketing=true AND PII=true TO executives
    ```
    This does not imply that executives now have access to all resources tagged as `PII` and **ALSO** to those tagged with `team:marketing`. Instead, executives are granted access **ONLY** to resources that are tagged with both `team:marketing=true` and `PII=true`.

---

:::tip
One way to reason about LF tagging is as follows:

- Adding tag _keys_ to a `GRANT`, effectively **REMOVES** permissions.
- Adding tag _values_ to a `GRANT`, effectively **ADDS** permissions.
- Adding `GRANT` statements to the same _principal_, effectively **ADDS** permissions.
- Adding tags without a `GRANT` to a _resource_, effectively **DOES NOTHING**.
:::